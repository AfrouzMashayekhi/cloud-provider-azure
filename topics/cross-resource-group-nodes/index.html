<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.61.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/cloud-provider-azure/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/cloud-provider-azure/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/cloud-provider-azure/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/cloud-provider-azure/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/cloud-provider-azure/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/cloud-provider-azure/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/cloud-provider-azure/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/cloud-provider-azure/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/cloud-provider-azure/favicons/android-192x192.png sizes=192x192><title>Deploy Cross Resource Group Nodes | Cloud Provider Azure</title><meta property="og:title" content="Deploy Cross Resource Group Nodes"><meta property="og:description" content="Deploy cross resource group nodes."><meta property="og:type" content="article"><meta property="og:url" content="https://nilo19.github.io/cloud-provider-azure/topics/cross-resource-group-nodes/"><meta property="article:modified_time" content="2020-08-17T12:13:17+08:00"><meta property="og:site_name" content="Cloud Provider Azure"><meta itemprop=name content="Deploy Cross Resource Group Nodes"><meta itemprop=description content="Deploy cross resource group nodes."><meta itemprop=dateModified content="2020-08-17T12:13:17+08:00"><meta itemprop=wordCount content="285"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploy Cross Resource Group Nodes"><meta name=twitter:description content="Deploy cross resource group nodes."><link rel=preload href=/cloud-provider-azure/scss/main.min.125f72e5d5a3aa7d4039aab0c22c38a18b1796f8d41a399c1dbc59e50f290ecd.css as=style><link href=/cloud-provider-azure/scss/main.min.125f72e5d5a3aa7d4039aab0c22c38a18b1796f8d41a399c1dbc59e50f290ecd.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/cloud-provider-azure/><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">Cloud Provider Azure</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cloud-provider-azure/install/><span>Installation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cloud-provider-azure/development/><span>Development</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/cloud-provider-azure/topics/><span class=active>Topics</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cloud-provider-azure/contribute/><span>Contribution</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cloud-provider-azure/example/><span>Example</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cloud-provider-azure/blog/><span>Release Notes</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cloud-provider-azure/faq/><span>FAQ</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/cloud-provider-azure/topics/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Topics</a></li><ul><li class="collapse show" id=cloud-provider-azure-topics><a class="td-sidebar-link td-sidebar-link__page" id=m-cloud-provider-azure-topics-loadbalancer href=/cloud-provider-azure/topics/loadbalancer/>Azure LoadBalancer</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-cloud-provider-azure-topics-azure-permissions href=/cloud-provider-azure/topics/azure-permissions/>Azure Permissions</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-cloud-provider-azure-topics-availability-zones href=/cloud-provider-azure/topics/availability-zones/>Availability Zones</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-cloud-provider-azure-topics-cross-resource-group-nodes href=/cloud-provider-azure/topics/cross-resource-group-nodes/>Cross Resource Group Nodes</a></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/kubernetes-sigs/cloud-provider-azure/edit/master/content/en/topics/cross-resource-group-nodes.md target=_blank><i class="fa fa-edit fa-fw"></i>Edit this page</a>
<a href="https://github.com/kubernetes-sigs/cloud-provider-azure/issues/new?title=Deploy%20Cross%20Resource%20Group%20Nodes" target=_blank><i class="fab fa-github fa-fw"></i>Create documentation issue</a>
<a href=https://github.com/kubernetes-sigs/cloud-provider-azure/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i>Create project issue</a></div><nav id=TableOfContents><ul><li><a href=#pre-requirements>Pre-requirements</a></li><li><a href=#cross-rg-nodes>Cross-RG nodes</a></li><li><a href=#unmanaged-nodes>Unmanaged nodes</a></li><li><a href=#reference>Reference</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://nilo19.github.io/cloud-provider-azure/topics/>Topics</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://nilo19.github.io/cloud-provider-azure/topics/cross-resource-group-nodes/>Cross Resource Group Nodes</a></li></ol></nav><div class=td-content><h1>Deploy Cross Resource Group Nodes</h1><div class=lead>Deploy cross resource group nodes.</div><p><strong>Feature status:</strong> Alpha since v1.12.</p><p>Kubernetes v1.12 adds support for cross resource group (RG) nodes and unmanaged (such as on-prem) nodes in Azure cloud provider. A few assumptions are made for such nodes:</p><ul><li>Cross-RG nodes are in same region and set with required labels (as clarified in the following part)</li><li>Nodes will not be part of the load balancer managed by cloud provider</li><li>Both node and container networking should be configured properly by provisioning tools</li><li>AzureDisk is supported for Azure cross-RG nodes, but not for on-prem nodes</li></ul><p><strong>TOC:</strong></p><ul><li><a href=#cross-resource-group-nodes>Cross resource group nodes</a><ul><li><a href=#pre-requirements>Pre-requirements</a></li><li><a href=#cross-rg-nodes>Cross-RG nodes</a></li><li><a href=#unmanaged-nodes>Unmanaged nodes</a></li><li><a href=#reference>Reference</a></li></ul></li></ul><h2 id=pre-requirements>Pre-requirements</h2><p>Because cross-RG nodes and unmanaged nodes won't be added to Azure load balancer backends, feature gate <code>ServiceNodeExclusion</code> should be enabled for master components (e.g. kube-controller-manager).</p><h2 id=cross-rg-nodes>Cross-RG nodes</h2><p>Cross-RG nodes should register themselves with required labels together with cloud provider:</p><ul><li><code>node.kubernetes.io/exclude-balancer</code>, which is used to exclude the node from load balancer.<ul><li><code>alpha.service-controller.kubernetes.io/exclude-balancer=true</code> should be used if the cluster version is below v1.16.0.</li></ul></li><li><code>kubernetes.azure.com/resource-group=&lt;rg-name></code>, which provides external RG and is used to get node information.</li><li>cloud provider config<ul><li><code>--cloud-provider=azure</code> when using kube-controller-manager</li><li><code>--cloud-provider=external</code> when using cloud-controller-manager</li></ul></li></ul><p>For example,</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubelet ... <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  --cloud-provider<span style=color:#ce5c00;font-weight:700>=</span>azure <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  --cloud-config<span style=color:#ce5c00;font-weight:700>=</span>/etc/kubernetes/azure.json <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  --node-labels<span style=color:#ce5c00;font-weight:700>=</span>node.kubernetes.io/exclude-balancer<span style=color:#ce5c00;font-weight:700>=</span>true,kubernetes.azure.com/resource-group<span style=color:#ce5c00;font-weight:700>=</span>&lt;rg-name&gt;
</code></pre></div><h2 id=unmanaged-nodes>Unmanaged nodes</h2><p>On-prem nodes are different from Azure nodes, all Azure coupled features (such as load balancers and Azure managed disks) are not supported for them. To prevent the node being deleted, Azure cloud provider will always assumes the node existing.</p><p>On-prem nodes should register themselves with labels <code>node.kubernetes.io/exclude-balancer=true</code> and <code>kubernetes.azure.com/managed=false</code>:</p><ul><li><code>node.kubernetes.io/exclude-balancer=true</code>, which is used to exclude the node from load balancer.</li><li><code>kubernetes.azure.com/managed=false</code>, which indicates the node is on-prem or on other clouds.</li></ul><p>For example,</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubelet ...<span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  --cloud-provider<span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  --node-labels<span style=color:#ce5c00;font-weight:700>=</span>node.kubernetes.io/exclude-balancer<span style=color:#ce5c00;font-weight:700>=</span>true,kubernetes.azure.com/managed<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span>
</code></pre></div><h2 id=reference>Reference</h2><p>See design docs for cross resource group nodes in <a href=https://github.com/kubernetes/enhancements/blob/master/keps/sig-cloud-provider/azure/20180809-cross-resource-group-nodes.md>KEP 20180809-cross-resource-group-nodes</a>.</p><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="feedback--answer feedback--answer-yes">Yes</button>
<button class="feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/USERNAME/REPOSITORY/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/USERNAME/REPOSITORY/issues/new>tell us how we can improve</a>.</p><script>const yesButton=document.querySelector('.feedback--answer-yes');const noButton=document.querySelector('.feedback--answer-no');const yesResponse=document.querySelector('.feedback--response-yes');const noResponse=document.querySelector('.feedback--response-no');const disableButtons=()=>{yesButton.disabled=true;noButton.disabled=true;};const sendFeedback=(value)=>{if(typeof ga!=='function')return;const args={command:'send',hitType:'event',category:'Helpful',action:'click',label:window.location.pathname,value:value};ga(args.command,args.hitType,args.category,args.action,args.label,args.value);};yesButton.addEventListener('click',()=>{yesResponse.classList.add('feedback--response__visible');disableButtons();sendFeedback(1);});noButton.addEventListener('click',()=>{noResponse.classList.add('feedback--response__visible');disableButtons();sendFeedback(0);});</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified August 17, 2020: <a href=https://github.com/kubernetes-sigs/cloud-provider-azure/commit/d4ac306d4f443b8bca88deba66a90357c5792c14>Refine doc website (d4ac306d)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Google Group" aria-label="Google Group"><a class=text-white target=_blank href=https://groups.google.com/forum/#!forum/kubernetes-sig-cloud-provider><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank href=https://github.com/kubernetes-sigs/cloud-provider-azure><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2020 The Docsy Authors All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank>Privacy Policy</a></small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/cloud-provider-azure/js/main.min.c804b36e9989ce787003fa1ab274ecaebc0c3eb0e2253094a39d5ea77cf46298.js integrity="sha256-yASzbpmJznhwA/oasnTsrrwMPrDiJTCUo51ep3z0Ypg=" crossorigin=anonymous></script></body></html>